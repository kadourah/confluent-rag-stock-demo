"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LocalKmsDriver = void 0;
const kms_registry_1 = require("../kms-registry");
const local_client_1 = require("./local-client");
class LocalKmsDriver {
    /**
     * Register the local KMS driver with the KMS registry.
     */
    static register() {
        (0, kms_registry_1.registerKmsDriver)(new LocalKmsDriver());
    }
    getKeyUrlPrefix() {
        return LocalKmsDriver.PREFIX;
    }
    newKmsClient(config, keyUrl) {
        let secret = config.get(LocalKmsDriver.SECRET);
        if (secret == null) {
            secret = process.env['LOCAL_SECRET'];
        }
        if (secret == null) {
            throw new Error('cannot load secret');
        }
        return new local_client_1.LocalKmsClient(secret);
    }
}
exports.LocalKmsDriver = LocalKmsDriver;
LocalKmsDriver.PREFIX = 'local-kms://';
LocalKmsDriver.SECRET = 'secret';
